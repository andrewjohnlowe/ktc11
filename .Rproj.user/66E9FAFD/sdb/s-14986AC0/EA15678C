{
    "collab_server" : "",
    "contents" : "library(plyr)\nlibrary(stringr)\nlibrary(readxl)\nlibrary(tidyr)\n\n\n## ingest data\n\nKTC_shell_data_20140120 <- read_excel(\"../data/KTC11_Database2012.20140120.xlsx\",sheet = \"Invertebrates\")\n\nKTC_lithic_data_20140120 <- read_excel(\"../data/KTC11_Database2012.20140120.xlsx\",sheet = \"Lithic Count & Mass (g)\")\n\nKTC_ceramic_data_20140120 <- read_excel(\"../data/KTC11_Database2012.20140120.xlsx\",sheet = \"Ceramic Count & Mass (g)\")\n\ndepths <- read.table(header = TRUE, text = \" UnitNum  depth\n                     1\t0.1\n                     2\t0.1\n                     3\t0.15\n                     4\t0.2\n                     5\t0.3\n                     6\t0.4\n                     7\t0.5\n                     8\t0.6\n                     9\t0.65\n                     10\t0.7\n                     11\t0.75\n                     12\t0.8\n                     13\t0.85\n                     14\t0.9\n                     15\t0.95\n                     16\t1\n                     17\t1.05\n                     18\t1.1\n                     19\t1.15\n                     20\t1.25\n                     \")\n\n###### clean data #######\n\n\n\n# trim spaces from around words and numbers\nTrim <- function (x) gsub(\"^\\\\s+|\\\\s+$\", \"\", x)\nKTC_shell_data_20140120$Taxon <- Trim(KTC_shell_data_20140120$Taxon)\n\n# convert chr to num\nKTC_shell_data_20140120$Mass..g. <- as.numeric(as.character(KTC_shell_data_20140120$Mass))\nKTC_shell_data_20140120$UnitNum <- as.numeric(str_extract(KTC_shell_data_20140120$Level, \"[0-9]+\"))\n\nKTC_lithic_data_20140120$Mass..g. <- as.numeric(as.character(KTC_lithic_data_20140120$Mass))\nKTC_lithic_data_20140120$UnitNum <- as.numeric(str_extract(KTC_lithic_data_20140120$Unit, \"[0-9]+\"))\n\n\nKTC_ceramic_data_20140120$Mass..g. <- as.numeric(as.character(KTC_ceramic_data_20140120$Mass))\nKTC_ceramic_data_20140120$UnitNum <- as.numeric(str_extract(KTC_ceramic_data_20140120$Unit, \"[0-9]+\"))\n\n# prepare data by adding depths and ages\n# add in a column for cal BP\n# join depths to main table by UnitNum\nKTC_shell_data_20140120 <- join(KTC_shell_data_20140120, depths,by='UnitNum')\nKTC_lithic_data_20140120 <- join(KTC_lithic_data_20140120, depths,by='UnitNum')\nKTC_ceramic_data_20140120 <- join(KTC_ceramic_data_20140120, depths,by='UnitNum')\n\n# create calBP column using age-depth function\nage <- function(d){11099.7 * d - 667.7}\n\nKTC_shell_data_20140120$calBP <- age(KTC_shell_data_20140120$depth)\nKTC_lithic_data_20140120$calBP <- age(KTC_lithic_data_20140120$depth)\nKTC_ceramic_data_20140120$calBP <- age(KTC_ceramic_data_20140120$depth)\n\n### Shell plot ####\n\n# summarise taxa by unit\nKTC_shell_data_20140120_summary <- ddply(KTC_shell_data_20140120, c(\"calBP\", \"Taxon\"), summarise, mass = sum(Mass..g.))\n\n# find most important shell species get total mass of each taxon\nddply(ddply(KTC_shell_data_20140120_summary, \"Taxon\", summarise, mass = (sum(mass))), .(mass))\n\n# subset most important and plot\nspecies <- c(\"Neoradina prasongi\", \"Amblemidae\", \"Cyclophoridae\", \"Telescopium telescopium\")\nKTC_shell_data_20140120_summary_plotting <- KTC_shell_data_20140120_summary[KTC_shell_data_20140120_summary$Taxon %in% species, ]\n\nlibrary(ggplot2)\nggplot(KTC_shell_data_20140120_summary_plotting, aes(calBP, mass, fill = Taxon)) +\n  geom_bar(stat = \"identity\", position = \"dodge\") +\n  xlab(\"years cal. BP\") +\n  ylab(\"mass (g)\") +\n  theme_bw(base_size = 18)\n\n### Lithic plot ####\n\n# summarise lithics by unit\nKTC_lithic_data_20140120_summary <- ddply(KTC_lithic_data_20140120, c(\"calBP\", \"`Lithic Type`\"), summarise, mass = sum(Mass..g.))\n\n# subset most important and plot\nlithic_type <- c(\"Flake\")\nKTC_lithic_data_20140120_summary_plotting <- KTC_lithic_data_20140120_summary[KTC_lithic_data_20140120_summary$`Lithic Type` %in% lithic_type,]\n\n# Plot\nggplot(KTC_lithic_data_20140120_summary_plotting, aes(calBP, mass)) +\n  geom_bar(stat = \"identity\", position = \"dodge\") +\n  xlab(\"years cal. BP\") +\n  ylab(\"mass (g)\") +\n  theme_bw(base_size = 18)\n\n### Ceramic plot ####\n\n# summarise ceramics by unit\nKTC_ceramic_data_20140120_summary <- ddply(KTC_ceramic_data_20140120, c(\"calBP\"), summarise, mass = sum(Mass..g.))\n\n# Plot\nggplot(KTC_ceramic_data_20140120_summary, aes(calBP, mass)) +\n  geom_bar(stat = \"identity\", position = \"dodge\") +\n  xlab(\"years cal. BP\") +\n  ylab(\"mass (g)\") +\n  theme_bw(base_size = 18)\n\n\n#### plot lithics and ceramics together\n\nlithics_ceramics_KTC <- merge(KTC_lithic_data_20140120_summary_plotting, KTC_ceramic_data_20140120_summary, by = \"calBP\", all = TRUE)\n\nlithics_ceramics_KTC_m <- gather(lithics_ceramics_KTC, age, mass, -calBP, -`Lithic Type` )\n\n# rename to make better plot labels\nlithics_ceramics_KTC_m$age <- ifelse(lithics_ceramics_KTC_m$age == \"mass.x\", \"Stone artefacts\", \"Ceramics\")\n\nggplot(lithics_ceramics_KTC_m, aes(calBP, mass)) +\n  geom_bar(stat = \"identity\") +\n  xlab(\"years cal. BP\") +\n  ylab(\"mass (g)\") +\n  theme_bw(base_size = 18) +\n  facet_grid(age ~ ., scales = \"free_y\")\n\n\n\n\n\n",
    "created" : 1452221064002.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2050729610",
    "id" : "EA15678C",
    "lastKnownWriteTime" : 1452221551,
    "last_content_update" : 1452221552035,
    "path" : "G:/My Documents/My UW/Teaching/Thailand fieldschool/2015 Thailand Fieldschool/NRCT report/code/NRCT report.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}